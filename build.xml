<?xml version="1.0"?>

<project name="multifield" basedir="." default="usage">

	<property name="name" value="neme-sys"/>
	
	<property name="docname" value="neme-sys_guide.pdf"/>

	<property name="src.dir" value="src"/>
	<property name="dist.dir" value="deploy"/>
	<property name="docs.dir" value="${dist.dir}/documentation"/>
	<property name="snippet.dir" value="${dist.dir}/snippet"/>
	<property name="mod_install.dir" value="${dist.dir}/mod_install"/>
	<property name="db.dir" value="db/mysql"/>	

	<tstamp>
		<format property="build.date" pattern="yyyyMMdd" />
	</tstamp>


	<target name="usage">
		<echo message=""/>
		<echo message="neme-sys .net build file"/>
		<echo message="--------------------------------------"/>
		<echo message=""/>
		<echo message="Available targets are:"/>
		<echo message=""/>
	
		<echo message="task 1 = neme-sys .net"/>
		<echo message="--> Compile main zip sources and others file and copy neme-sys .net documentations"/>	
		<echo message=""/>
		<echo message="task 2 = econeme-sys .net"/>
		<echo message="--> Compile main zip sources and others file and copy econeme-sys .net documentations"/>	
		<echo message=""/>
		<echo message="task 3 = up to econeme-sys .net"/>
		<echo message="--> build upgrate from neme-sys .net to econeme-sys .net"/>	
		<echo message=""/>
		<echo message="task 4 = all (neme-sys .net + econeme-sys .net + docs + upto econeme-sys .net)"/>
		<echo message="--> build neme-sys .net+docs, econeme-sys .net+docs+upto econeme-sys .net"/>
		<echo message=""/>
		<echo message="task 5 = demo"/>
		<echo message="--> build demo+docs"/>
		<echo message=""/>
		<echo message="task 6 = community module"/>
		<echo message="--> build community module"/>
		<echo message=""/>
		<echo message="task 7 = blog module"/>
		<echo message="--> build blog module"/>
		<echo message=""/>
		<echo message="task 8 = ads module"/>
		<echo message="--> build ads module"/>
		<echo message=""/>
		<echo message="task 9 = voucher module"/>
		<echo message="--> build voucher module"/>
		
		
		<echo message=""/>		
		<echo message="--------------------------------------"/>
		<echo message="press CTRL + C to exit"/>		
		<echo message=""/>
		<input message="choose a target (1,2,n): " addproperty="doTask"/>
		<input message="choose a version: " addproperty="buildVers"/>
		<antcall target="task${doTask}" />
	</target>
	
	
	<target name="make_dir_app" if="dirToCreateApp"> 
		<delete dir="${dist.dir}/${buildVers}"/>
		<mkdir dir="${dist.dir}/${buildVers}"/>
		<mkdir dir="${dist.dir}/${buildVers}/docs"/>
		<mkdir dir="${dist.dir}/${buildVers}/src"/>
		<mkdir dir="${dist.dir}/${buildVers}/tmp"/>
	</target>

	<target name="make_dir_demo" if="dirToCreateDemo"> 
		<delete dir="${dist.dir}/demo/${buildVers}"/>
		<mkdir dir="${dist.dir}/demo/${buildVers}"/>
		<mkdir dir="${dist.dir}/demo/${buildVers}/src"/>
	</target> 
	

	<target name="refresh_template_zip"> 
		<delete file="${src.dir}/public/utils/templates_neme-sys.zip"/>
		<delete file="${src.dir}/public/utils/templates_econeme-sys.zip"/>
		
		<zip destfile="${src.dir}/public/utils/templates_neme-sys.zip"> 
			<zipfileset dir="${src.dir}/public/templates"> 
				<include name="**/*"/>
				<!-- file esclusi e recuperati da dir templates -->
				<exclude name="**/IT/**"/>
				<exclude name="**/EN/**"/>
				<exclude name="shopping-card/**"/>
				<exclude name="products/**"/>
				<exclude name="ads-content/**"/>
				<exclude name="googlemap-product*/**"/>
				<exclude name="voucher-module*/**"/>
				<exclude name="voucher-module-friend*/**"/>
			</zipfileset>
		</zip>
		
		<zip destfile="${src.dir}/public/utils/templates_econeme-sys.zip"> 
			<zipfileset dir="${src.dir}/public/templates"> 
				<include name="**/*"/>
				<!-- file esclusi e recuperati da dir templates -->
				<exclude name="**/IT/**"/>
				<exclude name="**/EN/**"/>
			</zipfileset>
		</zip>			
	</target> 



<!--  *****************		BUILD NEME-SYS		***************** -->
	<target name="taskReplaceCms">
		<loadproperties srcFile="${mod_install.dir}/replace-resource/nemesys_replace.properties"/>
		
		<copy file="${src.dir}/web.config" todir="${dist.dir}/${buildVers}/tmp"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/web.config" flags="gis" byline="false" match="(&lt;!--nsys-web-config--&gt;)(.*?)(&lt;!---nsys-web-config--&gt;)" replace="\1${nsys-web-config}\3" />	
		
		<copy file="${src.dir}/global.asax" todir="${dist.dir}/${buildVers}/tmp"/>	
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/global.asax" flags="gis" byline="false" match="(&lt;!--nsys-globalasa2--&gt;)(.*?)(&lt;!---nsys-globalasa2--&gt;)" replace="\1${nsys-globalasa2}\3" />
		
		<copy file="${src.dir}/app_data/conf/nemesys-config.xml" todir="${dist.dir}/${buildVers}/tmp/app_data/conf"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig1--&gt;)(.*?)(&lt;!---nsys-nemesiconfig1--&gt;)" replace="\1${nsys-nemesiconfig1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig2--&gt;)(.*?)(&lt;!---nsys-nemesiconfig2--&gt;)" replace="\1${nsys-nemesiconfig2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig3--&gt;)(.*?)(&lt;!---nsys-nemesiconfig3--&gt;)" replace="\1${nsys-nemesiconfig3}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig4--&gt;)(.*?)(&lt;!---nsys-nemesiconfig4--&gt;)" replace="\1${nsys-nemesiconfig4}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig5--&gt;)(.*?)(&lt;!---nsys-nemesiconfig5--&gt;)" replace="\1${nsys-nemesiconfig5}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig6--&gt;)(.*?)(&lt;!---nsys-nemesiconfig6--&gt;)" replace="\1${nsys-nemesiconfig6}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig7--&gt;)(.*?)(&lt;!---nsys-nemesiconfig7--&gt;)" replace="\1${nsys-nemesiconfig7}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig8--&gt;)(.*?)(&lt;!---nsys-nemesiconfig8--&gt;)" replace="\1${nsys-nemesiconfig8}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig9--&gt;)(.*?)(&lt;!---nsys-nemesiconfig9--&gt;)" replace="\1${nsys-nemesiconfig9}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig10--&gt;)(.*?)(&lt;!---nsys-nemesiconfig10--&gt;)" replace="\1${nsys-nemesiconfig10}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig11--&gt;)(.*?)(&lt;!---nsys-nemesiconfig11--&gt;)" replace="\1${nsys-nemesiconfig11}\3" />

		<copy file="${src.dir}/app_data/conf/repository-mapping.xml" todir="${dist.dir}/${buildVers}/tmp/app_data/conf"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/repository-mapping.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesirepository1--&gt;)(.*?)(&lt;!---nsys-nemesirepository1--&gt;)" replace="\1${nsys-nemesirepository1}\3" />
		
		<copy file="${src.dir}/public/layout/area_user/account.ascx" todir="${dist.dir}/${buildVers}/tmp/public/layout/area_user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/area_user/account.ascx" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity1--&gt;)(.*?)(&lt;!---nsys-modcommunity1--&gt;)" replace="\1${nsys-modcommunity1}\3" /> 
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/area_user/account.ascx" flags="gis" byline="false" match="(/\*&lt;!--nsys-userproc1--&gt;\*/)(.*?)(/\*&lt;!---nsys-userproc1--&gt;\*/)" replace="\1${nsys-userproc1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/area_user/account.ascx" flags="gis" byline="false" match="(/\*&lt;!--nsys-userproc2--&gt;\*/)(.*?)(/\*&lt;!---nsys-userproc2--&gt;\*/)" replace="\1${nsys-userproc2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/area_user/account.ascx" flags="gis" byline="false" match="(/\*&lt;!--nsys-userproc3--&gt;\*/)(.*?)(/\*&lt;!---nsys-userproc3--&gt;\*/)" replace="\1${nsys-userproc3}\3" />
		
		<copy file="${src.dir}/public/layout/css/stile.css" todir="${dist.dir}/${buildVers}/tmp/public/layout/css"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/css/stile.css" flags="gis" byline="false" match="(/\*&lt;!--nsys-css1--&gt;\*/)(.*?)(/\*&lt;!---nsys-css1--&gt;\*/)" replace="\1${nsys-css1}\3" />
		
		<copy file="${src.dir}/public/layout/include/header.ascx" todir="${dist.dir}/${buildVers}/tmp/public/layout/include"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/include/header.ascx" flags="gis" byline="false" match="(&lt;!--nsys-head1--&gt;)(.*?)(&lt;!---nsys-head1--&gt;)" replace="\1${nsys-head1}\3" />
		
		<copy file="${src.dir}/public/layout/include/menu-frontend.ascx" todir="${dist.dir}/${buildVers}/tmp/public/layout/include"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/include/menu-frontend.ascx" flags="gis" byline="false" match="(&lt;!--nsys-inc1--&gt;)(.*?)(&lt;!---nsys-inc1--&gt;)" replace="\1${nsys-inc1}\3" />

		<copy file="${src.dir}/public/layout/addson/user/user-mask-widget.ascx" todir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user-mask-widget.ascx" flags="gis" byline="false" match="(&lt;!--nsys-incecom1--&gt;)(.*?)(&lt;!---nsys-incecom1--&gt;)" replace="\1${nsys-incecom1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user-mask-widget.ascx" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity3--&gt;)(.*?)(&lt;!---nsys-modcommunity3--&gt;)" replace="\1${nsys-modcommunity3}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user-mask-widget.ascx" flags="gis" byline="false" match="(&lt;!--nsys-modblog1--&gt;)(.*?)(&lt;!---nsys-modblog1--&gt;)" replace="\1${nsys-modblog1}\3" />

		<copy file="${src.dir}/public/layout/addson/user/user-online-widget.ascx" todir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user-online-widget.ascx" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity4--&gt;)(.*?)(&lt;!---nsys-modcommunity4--&gt;)" replace="\1${nsys-modcommunity4}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user-online-widget.ascx" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity5--&gt;)(.*?)(&lt;!---nsys-modcommunity5--&gt;)" replace="\1${nsys-modcommunity5}\3" />
		
		<copy file="${src.dir}/public/layout/addson/user/user-profile-widget.ascx" todir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user-profile-widget.ascx" flags="gis" byline="false" match="(//&lt;!--nsys-addsuser1--&gt;)(.*?)(//&lt;!---nsys-addsuser1--&gt;)" replace="\1${nsys-addsuser1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user-profile-widget.ascx" flags="gis" byline="false" match="(&lt;!--nsys-addsuser2--&gt;)(.*?)(&lt;!---nsys-addsuser2--&gt;)" replace="\1${nsys-addsuser2}\3" />

		<copy file="${src.dir}/public/layout/addson/comments/comments-widget.ascx" todir="${dist.dir}/${buildVers}/tmp/public/layout/addson/comments"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/comments/comments-widget.ascx" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity6--&gt;)(.*?)(&lt;!---nsys-modcommunity6--&gt;)" replace="\1${nsys-modcommunity6}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/comments/comments-widget.ascx" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity8--&gt;)(.*?)(&lt;!---nsys-modcommunity8--&gt;)" replace="\1${nsys-modcommunity8}\3" />

		<copy file="${src.dir}/backoffice/index.aspx" todir="${dist.dir}/${buildVers}/tmp/backoffice"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/index.aspx" flags="gis" byline="false" match="(&lt;!--nsys-bohome1--&gt;)(.*?)(&lt;!---nsys-bohome1--&gt;)" replace="\1${nsys-bohome1}\3" />

		<copy file="${src.dir}/backoffice/users/userlist.aspx" todir="${dist.dir}/${buildVers}/tmp/backoffice/users"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/users/userlist.aspx" flags="gis" byline="false" match="(&lt;!--nsys-usrlist6--&gt;)(.*?)(&lt;!---nsys-usrlist6--&gt;)" replace="\1${nsys-usrlist6}\3" />

		<copy file="${src.dir}/backoffice/users/insertuser.aspx" todir="${dist.dir}/${buildVers}/tmp/backoffice/users"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/users/insertuser.aspx" flags="gis" byline="false" match="(/\*&lt;!--nsys-usrins2--&gt;\*/)(.*?)(/\*&lt;!---nsys-usrins2--&gt;\*/)" replace="\1${nsys-usrins2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/users/insertuser.aspx" flags="gis" byline="false" match="(&lt;!--nsys-usrins3--&gt;)(.*?)(&lt;!---nsys-usrins3--&gt;)" replace="\1${nsys-usrins3}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/users/insertuser.aspx" flags="gis" byline="false" match="(//&lt;!--nsys-usrins4--&gt;)(.*?)(//&lt;!---nsys-usrins4--&gt;)" replace="\1${nsys-usrins4}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/users/insertuser.aspx" flags="gis" byline="false" match="(&lt;!--nsys-usrins5--&gt;)(.*?)(&lt;!---nsys-usrins5--&gt;)" replace="\1${nsys-usrins5}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/users/insertuser.aspx" flags="gis" byline="false" match="(&lt;!--nsys-usrins7--&gt;)(.*?)(&lt;!---nsys-usrins7--&gt;)" replace="\1${nsys-usrins7}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/users/insertuser.aspx" flags="gis" byline="false" match="(&lt;!--nsys-usrins8--&gt;)(.*?)(&lt;!---nsys-usrins8--&gt;)" replace="\1${nsys-usrins8}\3" />

		<copy file="${src.dir}/backoffice/users/insertfield.aspx" todir="${dist.dir}/${buildVers}/tmp/backoffice/users"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/users/insertfield.aspx" flags="gis" byline="false" match="(&lt;!--nsys-usrfld1--&gt;)(.*?)(&lt;!---nsys-usrfld1--&gt;)" replace="\1${nsys-usrfld1}\3" />

		<copy file="${src.dir}/backoffice/templates/ajaxviewtemplate.aspx" todir="${dist.dir}/${buildVers}/tmp/backoffice/templates"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/templates/ajaxviewtemplate.aspx" flags="gis" byline="false" match="(&lt;!--nsys-tmpajx1--&gt;)(.*?)(&lt;!---nsys-tmpajx1--&gt;)" replace="\1${nsys-tmpajx1}\3" />

		<copy file="${src.dir}/backoffice/newsletter/newsletterlist.aspx" todir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/newsletterlist.aspx" flags="gis" byline="false" match="(&lt;!--nsys-nwsletlist4--&gt;)(.*?)(&lt;!---nsys-nwsletlist4--&gt;)" replace="\1${nsys-nwsletlist4}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/newsletterlist.aspx" flags="gis" byline="false" match="(&lt;!--nsys-nwsletlist5--&gt;)(.*?)(&lt;!---nsys-nwsletlist5--&gt;)" replace="\1${nsys-nwsletlist5}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/newsletterlist.aspx" flags="gis" byline="false" match="(&lt;!--nsys-nwsletlist6--&gt;)(.*?)(&lt;!---nsys-nwsletlist6--&gt;)" replace="\1${nsys-nwsletlist6}\3" />

		<copy file="${src.dir}/backoffice/newsletter/newsletterlist.aspx.cs" todir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/newsletterlist.aspx.cs" flags="gis" byline="false" match="(/\*&lt;!--nsys-nwsletlist1--&gt;\*/)(.*?)(/\*&lt;!---nsys-nwsletlist1--&gt;\*/)" replace="\1${nsys-nwsletlist1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/newsletterlist.aspx.cs" flags="gis" byline="false" match="(/\*&lt;!--nsys-nwsletlist2--&gt;\*/)(.*?)(/\*&lt;!---nsys-nwsletlist2--&gt;\*/)" replace="\1${nsys-nwsletlist2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/newsletterlist.aspx.cs" flags="gis" byline="false" match="(/\*&lt;!--nsys-nwsletlist3--&gt;\*/)(.*?)(/\*&lt;!---nsys-nwsletlist3--&gt;\*/)" replace="\1${nsys-nwsletlist3}\3" />		
		
		<copy file="${src.dir}/backoffice/newsletter/insertnewsletter.aspx" todir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/insertnewsletter.aspx" flags="gis" byline="false" match="(&lt;!--nsys-nwsletins2--&gt;)(.*?)(&lt;!---nsys-nwsletins2--&gt;)" replace="\1${nsys-nwsletins2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/insertnewsletter.aspx" flags="gis" byline="false" match="(&lt;!--nsys-nwsletins3--&gt;)(.*?)(&lt;!---nsys-nwsletins3--&gt;)" replace="\1${nsys-nwsletins3}\3" />
		
		<copy file="${src.dir}/backoffice/newsletter/insertnewsletter.aspx.cs" todir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/insertnewsletter.aspx.cs" flags="gis" byline="false" match="(/\*&lt;!--nsys-nwsletins4--&gt;\*/)(.*?)(/\*&lt;!---nsys-nwsletins4--&gt;\*/)" replace="\1${nsys-nwsletins4}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/insertnewsletter.aspx.cs" flags="gis" byline="false" match="(/\*&lt;!--nsys-nwsletins5--&gt;\*/)(.*?)(/\*&lt;!---nsys-nwsletins5--&gt;\*/)" replace="\1${nsys-nwsletins5}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/insertnewsletter.aspx.cs" flags="gis" byline="false" match="(/\*&lt;!--nsys-nwsletins6--&gt;\*/)(.*?)(/\*&lt;!---nsys-nwsletins6--&gt;\*/)" replace="\1${nsys-nwsletins6}\3" />
		
		<copy file="${src.dir}/backoffice/include/menu.ascx" todir="${dist.dir}/${buildVers}/tmp/backoffice/include"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/include/menu.ascx" flags="gis" byline="false" match="(&lt;!--nsys-editinc1--&gt;)(.*?)(&lt;!---nsys-editinc1--&gt;)" replace="\1${nsys-editinc1}\3" />

		<copy file="${src.dir}/backoffice/countries/countrylist.aspx" todir="${dist.dir}/${buildVers}/tmp/backoffice/countries"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/countries/countrylist.aspx" flags="gis" byline="false" match="(&lt;!--nsys-cntlist1--&gt;)(.*?)(&lt;!---nsys-cntlist1--&gt;)" replace="\1${nsys-cntlist1}\3" />

		<copy file="${db.dir}/global_install_query.sql" todir="${dist.dir}/${buildVers}/tmp"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/global_install_query.sql" flags="gis" byline="false" match="buildVersSql" replace="${buildVers}" />
	</target>
	
	<target name="delete_zip_cms" if="zipToDeleteCms"> 
		<delete file="${dist.dir}/${buildVers}/src/${name}_${build.date}_${buildVers}.zip"/>
	</target> 	

	<target name="taskA" description="copy main source files into deploy dir, generate zip files">

		<condition property="dirToCreateApp"> 
			<and>
				<not>		
					<available file="${dist.dir}/${buildVers}" type="dir"> 
					</available>
				</not>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="dirToCreateApp: ${dirToCreateApp}" />		
		<antcall target="make_dir_app" />
		<echo message=""/>

		<condition property="zipToDeleteCms"> 
			<and>		
				<available file="${dist.dir}/${buildVers}/src/${name}_${build.date}_${buildVers}.zip"> 
				</available>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="zipToDeleteCms: ${zipToDeleteCms}" />		
		<antcall target="delete_zip_cms" /> 
		<echo message=""/>
		
		<echo message=""/>
		<echo message="refresh template zip" />		
		<antcall target="refresh_template_zip" /> 
		<echo message=""/>
		
		<antcall target="taskReplaceCms" />
		
		<zip destfile="${dist.dir}/${buildVers}/src/${name}_${build.date}_${buildVers}.zip"> 
			<zipfileset dir="${src.dir}"> 
				<include name="**/*"/>		
				
				<!-- file esclusi -->
				<exclude name="global.asax"/>
				<exclude name="favicon.ico"/>	
				<exclude name="sitemap.xml"/>
				<exclude name="web.config"/>
				<exclude name="**/test/**"/>
				<exclude name="area_user/vieworder.aspx"/>				
				<exclude name="area_user/userorders.aspx"/>				
				<exclude name="area_user/userorders.aspx.cs"/>				
				<exclude name="area_user/friends.aspx"/>				
				<exclude name="area_user/photos.aspx"/>			
				<exclude name="area_user/publicprofile.aspx"/>			
				<exclude name="**/area_user/ads/**"/>		
				<exclude name="common/img/logo.png"/>					
				<exclude name="common/include/checkin.asp"/>
				<exclude name="common/include/checkin_fault.asp"/>
				<exclude name="common/include/download-order-attach.aspx"/>		
				<exclude name="backoffice/index.aspx"/>
				<exclude name="backoffice/include/menu.ascx"/>
				<exclude name="backoffice/countries/countrylist.aspx"/>
				<exclude name="backoffice/users/userlist.aspx"/>
				<exclude name="backoffice/users/insertuser.aspx"/>
				<exclude name="backoffice/users/insertfield.aspx"/>
				<exclude name="backoffice/templates/ajaxviewtemplate.aspx"/>
				<exclude name="backoffice/newsletter/newsletterlist.aspx"/>
				<exclude name="backoffice/newsletter/newsletterlist.aspx.cs"/>
				<exclude name="backoffice/newsletter/insertnewsletter.aspx"/>
				<exclude name="backoffice/newsletter/insertnewsletter.aspx.cs"/>
				<exclude name="backoffice/img/logo.png"/>				
				<exclude name="**/backoffice/shoppingcart/**"/>
				<exclude name="**/backoffice/orders/**"/>
				<exclude name="**/backoffice/payments/**"/>
				<exclude name="**/backoffice/products/**"/>
				<exclude name="**/backoffice/charges/**"/>
				<exclude name="**/backoffice/fees/**"/>
				<exclude name="**/backoffice/currency/**"/>
				<exclude name="**/backoffice/business-strategy/**"/>
				<exclude name="**/backoffice/vouchers/**"/>	
				<exclude name="**/backoffice/supplements/**"/>
				<exclude name="public/layout/include/menu-frontend.ascx"/>
				<exclude name="public/layout/area_user/account.ascx"/>
				<exclude name="public/layout/area_user/friends.ascx"/>
				<exclude name="public/layout/area_user/photos.ascx"/>
				<exclude name="public/layout/area_user/publicprofile.ascx"/>		
				<exclude name="**/public/layout/css/stile.css"/>
				<exclude name="**/public/layout/include/header.ascx"/>				
				<exclude name="public/layout/addson/user/user-profile-widget.ascx"/>
				<exclude name="public/layout/addson/user/user-mask-widget.ascx"/>
				<exclude name="public/layout/addson/user/user-online-widget.ascx"/>
				<exclude name="public/layout/addson/contents/comments-widget.ascx"/>	
				
				<!-- *** escludo tutti i template eccetto il base *** -->
				<exclude name="**/public/templates/**/*"/>								
								
				<exclude name="**/public/upload/wysiwyg_editor/*.*"/>
				<exclude name="**/public/upload/files/categories/**/*"/>
				<exclude name="**/public/upload/files/contents/**/*"/>
				<exclude name="**/public/upload/files/products/**/*"/>
				<include name="**/public/upload/files/products/fields/*"/>
				<exclude name="**/public/upload/files/user/**/*"/>
				<exclude name="**/public/upload/files/header/**/*"/>
				<exclude name="**/public/upload/files/modules/**/*"/>
				
				<exclude name="**/public/utils/${docname}"/>
				<exclude name="**/public/utils/templates_econeme-sys.zip"/>
				
				<exclude name="**/app_data/conf/nemesys-config.xml"/>
				<exclude name="**/app_data/conf/repository-mapping.xml"/>

				<exclude name="**/app_code/hbm/ads.hbm.xml"/>
				<exclude name="**/app_code/hbm/BillsAddress.hbm.xml"/>
				<exclude name="**/app_code/hbm/BusinessRule.hbm.xml"/>
				<exclude name="**/app_code/hbm/Currency.hbm.xml"/>
				<exclude name="**/app_code/hbm/Fee.hbm.xml"/>
				<exclude name="**/app_code/hbm/Order.hbm.xml"/>
				<exclude name="**/app_code/hbm/Payment.hbm.xml"/>
				<exclude name="**/app_code/hbm/Product.hbm.xml"/>
				<exclude name="**/app_code/hbm/ShippingAddress.hbm.xml"/>
				<exclude name="**/app_code/hbm/ShoppingCart.hbm.xml"/>
				<exclude name="**/app_code/hbm/Supplement.hbm.xml"/>
				<exclude name="**/app_code/hbm/Voucher.hbm.xml"/>			
				
				<exclude name="**/app_code/com/nemesys/model/ads/**/*"/>
				<exclude name="**/app_code/com/nemesys/model/business-strategy/**/*"/>
				<exclude name="**/app_code/com/nemesys/model/cart/**/*"/>
				<exclude name="**/app_code/com/nemesys/model/currency/**/*"/>
				<exclude name="**/app_code/com/nemesys/model/fees/**/*"/>
				<exclude name="**/app_code/com/nemesys/model/order/**/*"/>
				<exclude name="**/app_code/com/nemesys/model/payment/**/*"/>
				<exclude name="**/app_code/com/nemesys/model/product/**/*"/>
				<exclude name="**/app_code/com/nemesys/model/supplement/**/*"/>
				<exclude name="**/app_code/com/nemesys/model/voucher/**/*"/>

				<exclude name="**/app_code/com/nemesys/database/repository/AdsRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/BillsAddressRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/BusinessRuleRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/CurrencyRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/FeeRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/IAdsRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/IBillsAddressRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/IBusinessRuleRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/ICurrencyRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/IFeeRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/IOrderRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/IPaymentModuleRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/IPaymentRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/IPaymentTransactionRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/IProductRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/IShippingAddressRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/IShoppingCartRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/ISupplementGroupRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/ISupplementRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/IVoucherRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/OrderRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/PaymentModuleRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/PaymentRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/PaymentTransactionRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/ProductRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/ShippingAddressRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/ShoppingCartRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/SupplementGroupRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/SupplementRepository.cs"/>
				<exclude name="**/app_code/com/nemesys/database/repository/VoucherRepository.cs"/>		
				
				<exclude name="**/app_code/com/nemesys/services/BusinessRuleService.cs"/>
				<exclude name="**/app_code/com/nemesys/services/FeeService.cs"/>
				<exclude name="**/app_code/com/nemesys/services/OrderService.cs"/>
				<exclude name="**/app_code/com/nemesys/services/PaymentService.cs"/>
				<exclude name="**/app_code/com/nemesys/services/ProductService.cs"/>
				<exclude name="**/app_code/com/nemesys/services/ShoppingCartService.cs"/>
				<exclude name="**/app_code/com/nemesys/services/VoucherService.cs"/>			
			</zipfileset>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp" includes="global.asax"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp" includes="web.config"/>	
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/app_data/conf" includes="nemesys-config.xml" fullpath="app_data/conf/nemesys-config.xml"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/app_data/conf" includes="repository-mapping.xml" fullpath="app_data/conf/repository-mapping.xml"/>		
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice" includes="index.aspx" prefix="backoffice"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/users" includes="userlist.aspx" prefix="backoffice/users"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/users" includes="insertuser.aspx" prefix="backoffice/users"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/users" includes="insertfield.aspx" prefix="backoffice/users"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/include" includes="menu.ascx" prefix="backoffice/include"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/countries" includes="countrylist.aspx" prefix="backoffice/countries"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/templates" includes="ajaxviewtemplate.aspx" prefix="backoffice/templates"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter" includes="newsletterlist.aspx" prefix="backoffice/newsletter"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter" includes="newsletterlist.aspx.cs" prefix="backoffice/newsletter"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter" includes="insertnewsletter.aspx" prefix="backoffice/newsletter"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter" includes="insertnewsletter.aspx.cs" prefix="backoffice/newsletter"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/area_user" includes="account.ascx" prefix="public/layout/area_user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/css" includes="stile.css" prefix="public/layout/css"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/include" includes="header.ascx" prefix="public/layout/include"/>	
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/include" includes="menu-frontend.ascx" prefix="public/layout/include"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user" includes="user-profile-widget.ascx" prefix="public/layout/addson/user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user" includes="user-mask-widget.ascx" prefix="public/layout/addson/user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user" includes="user-online-widget.ascx" prefix="public/layout/addson/user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/addson/comments" includes="comments-widget.ascx" prefix="public/layout/addson/comments"/>

			<!-- includo il logo di neme-sys al posto del logo econeme-sys -->
			<zipfileset dir="${snippet.dir}/cms/backoffice/img" includes="logo.png" prefix="backoffice/img"/>
			<zipfileset dir="${snippet.dir}/cms/common/img" includes="logo.png" prefix="common/img"/>
			<zipfileset dir="${snippet.dir}/cms" includes="favicon.ico" prefix=""/>

			<!-- includo il file global_install_query.sql di creazione/inserimento database -->
			<zipfileset dir="${dist.dir}/${buildVers}/tmp" includes="global_install_query.sql" prefix="public/install"/>
			
			<zipfileset dir="${mod_install.dir}" includes="portalinstall.aspx" prefix="public/install"/>
			<zipfileset dir="${mod_install.dir}/replace-resource" includes="nemesys_replace.properties" prefix="public/install"/>
			
			<!-- reintegro il template base, contact e search dentro la directory public/templates -->
			<zipfileset dir="${src.dir}/public/templates" includes="base/**/*" prefix="public/templates"/>
			<zipfileset dir="${src.dir}/public/templates" includes="search/**/*" prefix="public/templates"/>
			<zipfileset dir="${src.dir}/public/templates" includes="contact/**/*" prefix="public/templates"/>
		</zip>

		<delete includeemptydirs="true">
			<fileset dir="${dist.dir}/${buildVers}/tmp" includes="**/*"/>
		</delete>
		
	</target>	
	
	<target name="taskB" depends="taskA" description="copy docs files into deploy docs dir">
		
		<copy todir="${dist.dir}/${buildVers}/docs" preservelastmodified="true">
			<fileset dir="${docs.dir}" includes="${docname}" />
		</copy>

	</target>	

	<target name="task1" depends="taskA,taskB" description="build all neme-sys"/>
	


<!--  *****************		BUILD ECONEME-SYS		***************** -->		
	<target name="taskReplaceEco">
		<loadproperties srcFile="${mod_install.dir}/replace-resource/econemesys_replace.properties"/>
		
		<copy file="${src.dir}/app_data/conf/nemesys-config.xml" todir="${dist.dir}/${buildVers}/tmp/app_data/conf"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig2--&gt;)(.*?)(&lt;!---nsys-nemesiconfig2--&gt;)" replace="\1${nsys-nemesiconfig2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig3--&gt;)(.*?)(&lt;!---nsys-nemesiconfig3--&gt;)" replace="\1${nsys-nemesiconfig3}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig4--&gt;)(.*?)(&lt;!---nsys-nemesiconfig4--&gt;)" replace="\1${nsys-nemesiconfig4}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig5--&gt;)(.*?)(&lt;!---nsys-nemesiconfig5--&gt;)" replace="\1${nsys-nemesiconfig5}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig6--&gt;)(.*?)(&lt;!---nsys-nemesiconfig6--&gt;)" replace="\1${nsys-nemesiconfig6}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig7--&gt;)(.*?)(&lt;!---nsys-nemesiconfig7--&gt;)" replace="\1${nsys-nemesiconfig7}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig8--&gt;)(.*?)(&lt;!---nsys-nemesiconfig8--&gt;)" replace="\1${nsys-nemesiconfig8}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig9--&gt;)(.*?)(&lt;!---nsys-nemesiconfig9--&gt;)" replace="\1${nsys-nemesiconfig9}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig10--&gt;)(.*?)(&lt;!---nsys-nemesiconfig10--&gt;)" replace="\1${nsys-nemesiconfig10}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig11--&gt;)(.*?)(&lt;!---nsys-nemesiconfig11--&gt;)" replace="\1${nsys-nemesiconfig11}\3" />
		
		<copy file="${src.dir}/public/layout/css/stile.css" todir="${dist.dir}/${buildVers}/tmp/public/layout/css"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/css/stile.css" flags="gis" byline="false" match="(/\*&lt;!--nsys-css1--&gt;\*/)(.*?)(/\*&lt;!---nsys-css1--&gt;\*/)" replace="\1${nsys-css1}\3" />
		
		<copy file="${src.dir}/public/layout/include/header.ascx" todir="${dist.dir}/${buildVers}/tmp/public/layout/include"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/include/header.ascx" flags="gis" byline="false" match="(&lt;!--nsys-head1--&gt;)(.*?)(&lt;!---nsys-head1--&gt;)" replace="\1${nsys-head1}\3" />		
		
		<copy file="${src.dir}/public/layout/area_user/account.ascx" todir="${dist.dir}/${buildVers}/tmp/public/layout/area_user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/area_user/account.ascx" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity1--&gt;)(.*?)(&lt;!---nsys-modcommunity1--&gt;)" replace="\1${nsys-modcommunity1}\3" /> 
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/area_user/account.ascx" flags="gis" byline="false" match="(/\*&lt;!--nsys-userproc1--&gt;\*/)(.*?)(/\*&lt;!---nsys-userproc1--&gt;\*/)" replace="\1${nsys-userproc1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/area_user/account.ascx" flags="gis" byline="false" match="(/\*&lt;!--nsys-userproc2--&gt;\*/)(.*?)(/\*&lt;!---nsys-userproc2--&gt;\*/)" replace="\1${nsys-userproc2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/area_user/account.ascx" flags="gis" byline="false" match="(/\*&lt;!--nsys-userproc3--&gt;\*/)(.*?)(/\*&lt;!---nsys-userproc3--&gt;\*/)" replace="\1${nsys-userproc3}\3" />
		
		<copy file="${src.dir}/public/layout/addson/user/user-mask-widget.ascx" todir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user-mask-widget.ascx" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity3--&gt;)(.*?)(&lt;!---nsys-modcommunity3--&gt;)" replace="\1${nsys-modcommunity3}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user-mask-widget.ascx" flags="gis" byline="false" match="(&lt;!--nsys-modblog1--&gt;)(.*?)(&lt;!---nsys-modblog1--&gt;)" replace="\1${nsys-modblog1}\3" />

		<copy file="${src.dir}/public/layout/addson/user/user-online-widget.ascx" todir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user-online-widget.ascx" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity4--&gt;)(.*?)(&lt;!---nsys-modcommunity4--&gt;)" replace="\1${nsys-modcommunity4}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user-online-widget.ascx" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity5--&gt;)(.*?)(&lt;!---nsys-modcommunity5--&gt;)" replace="\1${nsys-modcommunity5}\3" />
		
		<copy file="${src.dir}/public/layout/addson/user/user-profile-widget.ascx" todir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user-profile-widget.ascx" flags="gis" byline="false" match="(//&lt;!--nsys-addsuser1--&gt;)(.*?)(//&lt;!---nsys-addsuser1--&gt;)" replace="\1${nsys-addsuser1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user-profile-widget.ascx" flags="gis" byline="false" match="(&lt;!--nsys-addsuser2--&gt;)(.*?)(&lt;!---nsys-addsuser2--&gt;)" replace="\1${nsys-addsuser2}\3" />

		<copy file="${src.dir}/public/layout/addson/comments/comments-widget.ascx" todir="${dist.dir}/${buildVers}/tmp/public/layout/addson/comments"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/comments/comments-widget.ascx" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity6--&gt;)(.*?)(&lt;!---nsys-modcommunity6--&gt;)" replace="\1${nsys-modcommunity6}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/comments/comments-widget.ascx" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity8--&gt;)(.*?)(&lt;!---nsys-modcommunity8--&gt;)" replace="\1${nsys-modcommunity8}\3" />

		<copy file="${src.dir}/backoffice/newsletter/newsletterlist.aspx" todir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/newsletterlist.aspx" flags="gis" byline="false" match="(&lt;!--nsys-nwsletlist4--&gt;)(.*?)(&lt;!---nsys-nwsletlist4--&gt;)" replace="\1${nsys-nwsletlist4}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/newsletterlist.aspx" flags="gis" byline="false" match="(&lt;!--nsys-nwsletlist5--&gt;)(.*?)(&lt;!---nsys-nwsletlist5--&gt;)" replace="\1${nsys-nwsletlist5}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/newsletterlist.aspx" flags="gis" byline="false" match="(&lt;!--nsys-nwsletlist6--&gt;)(.*?)(&lt;!---nsys-nwsletlist6--&gt;)" replace="\1${nsys-nwsletlist6}\3" />

		<copy file="${src.dir}/backoffice/newsletter/newsletterlist.aspx.cs" todir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/newsletterlist.aspx.cs" flags="gis" byline="false" match="(/\*&lt;!--nsys-nwsletlist1--&gt;\*/)(.*?)(/\*&lt;!---nsys-nwsletlist1--&gt;\*/)" replace="\1${nsys-nwsletlist1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/newsletterlist.aspx.cs" flags="gis" byline="false" match="(/\*&lt;!--nsys-nwsletlist2--&gt;\*/)(.*?)(/\*&lt;!---nsys-nwsletlist2--&gt;\*/)" replace="\1${nsys-nwsletlist2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/newsletterlist.aspx.cs" flags="gis" byline="false" match="(/\*&lt;!--nsys-nwsletlist3--&gt;\*/)(.*?)(/\*&lt;!---nsys-nwsletlist3--&gt;\*/)" replace="\1${nsys-nwsletlist3}\3" />		
		
		<copy file="${src.dir}/backoffice/newsletter/insertnewsletter.aspx" todir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/insertnewsletter.aspx" flags="gis" byline="false" match="(&lt;!--nsys-nwsletins2--&gt;)(.*?)(&lt;!---nsys-nwsletins2--&gt;)" replace="\1${nsys-nwsletins2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/insertnewsletter.aspx" flags="gis" byline="false" match="(&lt;!--nsys-nwsletins3--&gt;)(.*?)(&lt;!---nsys-nwsletins3--&gt;)" replace="\1${nsys-nwsletins3}\3" />
		
		<copy file="${src.dir}/backoffice/newsletter/insertnewsletter.aspx.cs" todir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/insertnewsletter.aspx.cs" flags="gis" byline="false" match="(/\*&lt;!--nsys-nwsletins4--&gt;\*/)(.*?)(/\*&lt;!---nsys-nwsletins4--&gt;\*/)" replace="\1${nsys-nwsletins4}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/insertnewsletter.aspx.cs" flags="gis" byline="false" match="(/\*&lt;!--nsys-nwsletins5--&gt;\*/)(.*?)(/\*&lt;!---nsys-nwsletins5--&gt;\*/)" replace="\1${nsys-nwsletins5}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/insertnewsletter.aspx.cs" flags="gis" byline="false" match="(/\*&lt;!--nsys-nwsletins6--&gt;\*/)(.*?)(/\*&lt;!---nsys-nwsletins6--&gt;\*/)" replace="\1${nsys-nwsletins6}\3" />		
		
		<copy file="${src.dir}/backoffice/business-strategy/insertbusinessrule.aspx" todir="${dist.dir}/${buildVers}/tmp/backoffice/business-strategy"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/business-strategy/insertbusinessrule.aspx" flags="gis" byline="false" match="(&lt;!--nsys-voucher2--&gt;)(.*?)(&lt;!---nsys-voucher2--&gt;)" replace="\1${nsys-voucher2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/business-strategy/insertbusinessrule.aspx" flags="gis" byline="false" match="(&lt;!--nsys-voucher3--&gt;)(.*?)(&lt;!---nsys-voucher3--&gt;)" replace="\1${nsys-voucher3}\3" />
		
		<copy file="${src.dir}/backoffice/business-strategy/insertbusinessrule.aspx.cs" todir="${dist.dir}/${buildVers}/tmp/backoffice/business-strategy"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/business-strategy/insertbusinessrule.aspx.cs" flags="gis" byline="false" match="(/\*&lt;!--nsys-voucher4--&gt;\*/)(.*?)(/\*&lt;!---nsys-voucher4--&gt;\*/)" replace="\1${nsys-voucher4}\3" />
		
		<copy file="${db.dir}/global_install_query_ec.sql" todir="${dist.dir}/${buildVers}/tmp"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/global_install_query_ec.sql" flags="gis" byline="false" match="buildVersSql" replace="${buildVers}" />		
		
		<copy file="${src.dir}/backoffice/include/menu.ascx" todir="${dist.dir}/${buildVers}/tmp/backoffice/include"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/include/menu.ascx" flags="gis" byline="false" match="(&lt;!--nsys-voucher1--&gt;)(.*?)(&lt;!---nsys-voucher1--&gt;)" replace="\1${nsys-voucher1}\3" />	
	</target>
	
	<target name="delete_zip_cms.ec" if="zipToDeleteEc"> 
		<delete file="${dist.dir}/${buildVers}/src/eco${name}_${build.date}_${buildVers}.zip"/>
	</target> 
	
	<target name="taskC" description="copy main source files into deploy dir, generate zip files">

		<condition property="dirToCreateApp"> 
			<and>
				<not>		
					<available file="${dist.dir}/${buildVers}" type="dir"> 
					</available>
				</not>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="dirToCreateApp: ${dirToCreateApp}" />		
		<antcall target="make_dir_app" />  
		<echo message=""/>

		<condition property="zipToDeleteEc"> 
			<and>		
				<available file="${dist.dir}/${buildVers}/src/eco${name}_${build.date}_${buildVers}.zip"> 
				</available>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="zipToDeleteEc: ${zipToDeleteEc}" />		
		<antcall target="delete_zip_cms.ec" /> 
		<echo message=""/>
		
		<echo message=""/>
		<echo message="refresh template zip" />		
		<antcall target="refresh_template_zip" /> 
		<echo message=""/>
		
		<antcall target="taskReplaceEco" />

		<zip destfile="${dist.dir}/${buildVers}/src/eco${name}_${build.date}_${buildVers}.zip"> 
			<zipfileset dir="${src.dir}"> 
				<include name="**/*"/>
				
				<!-- file esclusi -->
				<exclude name="favicon.ico"/>	
				<exclude name="sitemap.xml"/>
				<exclude name="**/test/**"/>			
				<exclude name="area_user/friends.aspx"/>				
				<exclude name="area_user/photos.aspx"/>			
				<exclude name="area_user/publicprofile.aspx"/>			
				<exclude name="**/area_user/ads/**"/>		
				<exclude name="common/img/logo.png"/>	
				<exclude name="backoffice/include/menu.ascx"/>
				<exclude name="backoffice/newsletter/newsletterlist.aspx"/>
				<exclude name="backoffice/newsletter/newsletterlist.aspx.cs"/>
				<exclude name="backoffice/newsletter/insertnewsletter.aspx"/>
				<exclude name="backoffice/newsletter/insertnewsletter.aspx.cs"/>
				<exclude name="backoffice/business-strategy/insertbusinessrule.aspx"/>
				<exclude name="backoffice/business-strategy/insertbusinessrule.aspx.cs"/>
				<exclude name="public/layout/area_user/account.ascx"/>
				<exclude name="public/layout/area_user/friends.ascx"/>
				<exclude name="public/layout/area_user/photos.ascx"/>
				<exclude name="public/layout/area_user/publicprofile.ascx"/>	
				<exclude name="**/public/layout/css/stile.css"/>
				<exclude name="**/public/layout/include/header.ascx"/>				
				<exclude name="public/layout/addson/user/user-profile-widget.ascx"/>
				<exclude name="public/layout/addson/user/user-mask-widget.ascx"/>
				<exclude name="public/layout/addson/user/user-online-widget.ascx"/>
				<exclude name="public/layout/addson/contents/comments-widget.ascx"/>		
				
				<!-- file esclusi per il modulo voucher -->
				<exclude name="backoffice/include/menu.ascx"/>
				<exclude name="**/backoffice/vouchers/**"/>	
				
				<!-- *** escludo tutti i template eccetto il base *** -->
				<exclude name="**/public/templates/**/*"/>								
								
				<exclude name="**/public/upload/wysiwyg_editor/*.*"/>
				<exclude name="**/public/upload/files/categories/**/*"/>
				<exclude name="**/public/upload/files/contents/**/*"/>
				<exclude name="**/public/upload/files/products/**/*"/>
				<include name="**/public/upload/files/products/fields/*"/>
				<exclude name="**/public/upload/files/user/**/*"/>
				<exclude name="**/public/upload/files/header/**/*"/>
				<exclude name="**/public/upload/files/modules/**/*"/>
				
				<exclude name="**/public/utils/${docname}"/>
				<exclude name="**/public/utils/templates_econeme-sys.zip"/>
				
				<exclude name="**/app_data/conf/nemesys-config.xml"/>
				
			</zipfileset>
			
			<zipfileset dir="${mod_install.dir}" includes="portalinstall.aspx" prefix="public/install"/>			
			<zipfileset dir="${mod_install.dir}/replace-resource" includes="nemesys_replace.properties" prefix="public/install"/>
			<zipfileset dir="${mod_install.dir}/replace-resource" includes="econemesys_replace.properties" prefix="public/install"/>

			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/include" includes="menu.ascx" prefix="backoffice/include"/>
			
			<!-- includo il logo di neme-sys al posto del logo econeme-sys -->
			<zipfileset dir="${snippet.dir}/ecommerce/common/img" includes="logo.png" prefix="common/img"/>
			<zipfileset dir="${snippet.dir}/ecommerce" includes="favicon.ico" prefix=""/>

			<!-- includo il file global_install_query.sql di creazione/inserimento database -->
			<zipfileset dir="${dist.dir}/${buildVers}/tmp" includes="global_install_query_ec.sql" fullpath="public/install/global_install_query.sql"/>

			<!-- includo i template di esempio di econeme-sys dentro la directory public/utils -->
			<zipfileset dir="${src.dir}/public/utils" includes="templates_econeme-sys.zip" fullpath="public/utils/templates_neme-sys.zip"/>
			
			<!-- reintegro il template base, contact e search dentro la directory public/templates -->
			<zipfileset dir="${src.dir}/public/templates" includes="base/**/*" prefix="public/templates"/>
			<zipfileset dir="${src.dir}/public/templates" includes="base-product/**/*" prefix="public/templates"/>
			<zipfileset dir="${src.dir}/public/templates" includes="search/**/*" prefix="public/templates"/>
			<zipfileset dir="${src.dir}/public/templates" includes="contact/**/*" prefix="public/templates"/>	
			<zipfileset dir="${src.dir}/public/templates" includes="shopping-card/**/*" prefix="public/templates"/>
			
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter" includes="newsletterlist.aspx" prefix="backoffice/newsletter"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter" includes="newsletterlist.aspx.cs" prefix="backoffice/newsletter"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter" includes="insertnewsletter.aspx" prefix="backoffice/newsletter"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter" includes="insertnewsletter.aspx.cs" prefix="backoffice/newsletter"/>
			
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/business-strategy" includes="insertbusinessrule.aspx" prefix="backoffice/business-strategy"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/business-strategy" includes="insertbusinessrule.aspx.cs" prefix="backoffice/business-strategy"/>
					
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/app_data/conf" includes="nemesys-config.xml" fullpath="app_data/conf/nemesys-config.xml"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/area_user" includes="account.ascx" prefix="public/layout/area_user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/css" includes="stile.css" prefix="public/layout/css"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/include" includes="header.ascx" prefix="public/layout/include"/>	
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user" includes="user-profile-widget.ascx" prefix="public/layout/addson/user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user" includes="user-mask-widget.ascx" prefix="public/layout/addson/user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user" includes="user-online-widget.ascx" prefix="public/layout/addson/user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/addson/comments" includes="comments-widget.ascx" prefix="public/layout/addson/comments"/>	
		</zip>

		<delete includeemptydirs="true">
			<fileset dir="${dist.dir}/${buildVers}/tmp" includes="**/*"/>
		</delete>

	</target>	
	
	<target name="taskD" depends="taskC" description="copy docs files into deploy docs dir">
		
		<copy todir="${dist.dir}/${buildVers}/docs" preservelastmodified="true">
			<fileset dir="${docs.dir}" includes="eco${docname}" />
		</copy>

	</target>	
	
	<target name="task2" depends="taskC,taskD" description="build all econeme-sys"/>	
	
	

<!--  *****************		BUILD UPGRADE TO ECONEME-SYS		***************** -->			
	<target name="taskReplaceUpEco">
		<loadproperties srcFile="${mod_install.dir}/replace-resource/econemesys_replace.properties"/>
		
		<copy file="${src.dir}/app_data/conf/nemesys-config.xml" todir="${dist.dir}/${buildVers}/tmp/app_data/conf"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig2--&gt;)(.*?)(&lt;!---nsys-nemesiconfig2--&gt;)" replace="\1${nsys-nemesiconfig2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig3--&gt;)(.*?)(&lt;!---nsys-nemesiconfig3--&gt;)" replace="\1${nsys-nemesiconfig3}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig4--&gt;)(.*?)(&lt;!---nsys-nemesiconfig4--&gt;)" replace="\1${nsys-nemesiconfig4}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig5--&gt;)(.*?)(&lt;!---nsys-nemesiconfig5--&gt;)" replace="\1${nsys-nemesiconfig5}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig6--&gt;)(.*?)(&lt;!---nsys-nemesiconfig6--&gt;)" replace="\1${nsys-nemesiconfig6}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig7--&gt;)(.*?)(&lt;!---nsys-nemesiconfig7--&gt;)" replace="\1${nsys-nemesiconfig7}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig8--&gt;)(.*?)(&lt;!---nsys-nemesiconfig8--&gt;)" replace="\1${nsys-nemesiconfig8}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig9--&gt;)(.*?)(&lt;!---nsys-nemesiconfig9--&gt;)" replace="\1${nsys-nemesiconfig9}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig10--&gt;)(.*?)(&lt;!---nsys-nemesiconfig10--&gt;)" replace="\1${nsys-nemesiconfig10}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/app_data/conf/nemesys-config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig11--&gt;)(.*?)(&lt;!---nsys-nemesiconfig11--&gt;)" replace="\1${nsys-nemesiconfig11}\3" />
		
		<copy file="${src.dir}/public/layout/css/stile.css" todir="${dist.dir}/${buildVers}/tmp/public/layout/css"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/css/stile.css" flags="gis" byline="false" match="(/\*&lt;!--nsys-css1--&gt;\*/)(.*?)(/\*&lt;!---nsys-css1--&gt;\*/)" replace="\1${nsys-css1}\3" />
		
		<copy file="${src.dir}/public/layout/include/header.ascx" todir="${dist.dir}/${buildVers}/tmp/public/layout/include"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/include/header.ascx" flags="gis" byline="false" match="(&lt;!--nsys-head1--&gt;)(.*?)(&lt;!---nsys-head1--&gt;)" replace="\1${nsys-head1}\3" />		
		
		<copy file="${src.dir}/public/layout/area_user/account.ascx" todir="${dist.dir}/${buildVers}/tmp/public/layout/area_user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/area_user/account.ascx" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity1--&gt;)(.*?)(&lt;!---nsys-modcommunity1--&gt;)" replace="\1${nsys-modcommunity1}\3" /> 
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/area_user/account.ascx" flags="gis" byline="false" match="(/\*&lt;!--nsys-userproc1--&gt;\*/)(.*?)(/\*&lt;!---nsys-userproc1--&gt;\*/)" replace="\1${nsys-userproc1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/area_user/account.ascx" flags="gis" byline="false" match="(/\*&lt;!--nsys-userproc2--&gt;\*/)(.*?)(/\*&lt;!---nsys-userproc2--&gt;\*/)" replace="\1${nsys-userproc2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/area_user/account.ascx" flags="gis" byline="false" match="(/\*&lt;!--nsys-userproc3--&gt;\*/)(.*?)(/\*&lt;!---nsys-userproc3--&gt;\*/)" replace="\1${nsys-userproc3}\3" />
		
		<copy file="${src.dir}/public/layout/addson/user/user-mask-widget.ascx" todir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user-mask-widget.ascx" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity3--&gt;)(.*?)(&lt;!---nsys-modcommunity3--&gt;)" replace="\1${nsys-modcommunity3}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user-mask-widget.ascx" flags="gis" byline="false" match="(&lt;!--nsys-modblog1--&gt;)(.*?)(&lt;!---nsys-modblog1--&gt;)" replace="\1${nsys-modblog1}\3" />

		<copy file="${src.dir}/public/layout/addson/user/user-online-widget.ascx" todir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user-online-widget.ascx" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity4--&gt;)(.*?)(&lt;!---nsys-modcommunity4--&gt;)" replace="\1${nsys-modcommunity4}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user-online-widget.ascx" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity5--&gt;)(.*?)(&lt;!---nsys-modcommunity5--&gt;)" replace="\1${nsys-modcommunity5}\3" />
		
		<copy file="${src.dir}/public/layout/addson/user/user-profile-widget.ascx" todir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user-profile-widget.ascx" flags="gis" byline="false" match="(//&lt;!--nsys-addsuser1--&gt;)(.*?)(//&lt;!---nsys-addsuser1--&gt;)" replace="\1${nsys-addsuser1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user-profile-widget.ascx" flags="gis" byline="false" match="(&lt;!--nsys-addsuser2--&gt;)(.*?)(&lt;!---nsys-addsuser2--&gt;)" replace="\1${nsys-addsuser2}\3" />

		<copy file="${src.dir}/public/layout/addson/comments/comments-widget.ascx" todir="${dist.dir}/${buildVers}/tmp/public/layout/addson/comments"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/comments/comments-widget.ascx" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity6--&gt;)(.*?)(&lt;!---nsys-modcommunity6--&gt;)" replace="\1${nsys-modcommunity6}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/comments/comments-widget.ascx" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity8--&gt;)(.*?)(&lt;!---nsys-modcommunity8--&gt;)" replace="\1${nsys-modcommunity8}\3" />

		<copy file="${src.dir}/backoffice/newsletter/newsletterlist.aspx" todir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/newsletterlist.aspx" flags="gis" byline="false" match="(&lt;!--nsys-nwsletlist4--&gt;)(.*?)(&lt;!---nsys-nwsletlist4--&gt;)" replace="\1${nsys-nwsletlist4}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/newsletterlist.aspx" flags="gis" byline="false" match="(&lt;!--nsys-nwsletlist5--&gt;)(.*?)(&lt;!---nsys-nwsletlist5--&gt;)" replace="\1${nsys-nwsletlist5}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/newsletterlist.aspx" flags="gis" byline="false" match="(&lt;!--nsys-nwsletlist6--&gt;)(.*?)(&lt;!---nsys-nwsletlist6--&gt;)" replace="\1${nsys-nwsletlist6}\3" />

		<copy file="${src.dir}/backoffice/newsletter/newsletterlist.aspx.cs" todir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/newsletterlist.aspx.cs" flags="gis" byline="false" match="(/\*&lt;!--nsys-nwsletlist1--&gt;\*/)(.*?)(/\*&lt;!---nsys-nwsletlist1--&gt;\*/)" replace="\1${nsys-nwsletlist1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/newsletterlist.aspx.cs" flags="gis" byline="false" match="(/\*&lt;!--nsys-nwsletlist2--&gt;\*/)(.*?)(/\*&lt;!---nsys-nwsletlist2--&gt;\*/)" replace="\1${nsys-nwsletlist2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/newsletterlist.aspx.cs" flags="gis" byline="false" match="(/\*&lt;!--nsys-nwsletlist3--&gt;\*/)(.*?)(/\*&lt;!---nsys-nwsletlist3--&gt;\*/)" replace="\1${nsys-nwsletlist3}\3" />		
		
		<copy file="${src.dir}/backoffice/newsletter/insertnewsletter.aspx" todir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/insertnewsletter.aspx" flags="gis" byline="false" match="(&lt;!--nsys-nwsletins2--&gt;)(.*?)(&lt;!---nsys-nwsletins2--&gt;)" replace="\1${nsys-nwsletins2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/insertnewsletter.aspx" flags="gis" byline="false" match="(&lt;!--nsys-nwsletins3--&gt;)(.*?)(&lt;!---nsys-nwsletins3--&gt;)" replace="\1${nsys-nwsletins3}\3" />
		
		<copy file="${src.dir}/backoffice/newsletter/insertnewsletter.aspx.cs" todir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/insertnewsletter.aspx.cs" flags="gis" byline="false" match="(/\*&lt;!--nsys-nwsletins4--&gt;\*/)(.*?)(/\*&lt;!---nsys-nwsletins4--&gt;\*/)" replace="\1${nsys-nwsletins4}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/insertnewsletter.aspx.cs" flags="gis" byline="false" match="(/\*&lt;!--nsys-nwsletins5--&gt;\*/)(.*?)(/\*&lt;!---nsys-nwsletins5--&gt;\*/)" replace="\1${nsys-nwsletins5}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/newsletter/insertnewsletter.aspx.cs" flags="gis" byline="false" match="(/\*&lt;!--nsys-nwsletins6--&gt;\*/)(.*?)(/\*&lt;!---nsys-nwsletins6--&gt;\*/)" replace="\1${nsys-nwsletins6}\3" />		
		
		<copy file="${src.dir}/backoffice/business-strategy/insertbusinessrule.aspx" todir="${dist.dir}/${buildVers}/tmp/backoffice/business-strategy"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/business-strategy/insertbusinessrule.aspx" flags="gis" byline="false" match="(&lt;!--nsys-voucher2--&gt;)(.*?)(&lt;!---nsys-voucher2--&gt;)" replace="\1${nsys-voucher2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/business-strategy/insertbusinessrule.aspx" flags="gis" byline="false" match="(&lt;!--nsys-voucher3--&gt;)(.*?)(&lt;!---nsys-voucher3--&gt;)" replace="\1${nsys-voucher3}\3" />
		
		<copy file="${src.dir}/backoffice/business-strategy/insertbusinessrule.aspx.cs" todir="${dist.dir}/${buildVers}/tmp/backoffice/business-strategy"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/business-strategy/insertbusinessrule.aspx.cs" flags="gis" byline="false" match="(/\*&lt;!--nsys-voucher4--&gt;\*/)(.*?)(/\*&lt;!---nsys-voucher4--&gt;\*/)" replace="\1${nsys-voucher4}\3" />	
		
		<copy file="${src.dir}/backoffice/include/menu.ascx" todir="${dist.dir}/${buildVers}/tmp/backoffice/include"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/backoffice/include/menu.ascx" flags="gis" byline="false" match="(&lt;!--nsys-voucher1--&gt;)(.*?)(&lt;!---nsys-voucher1--&gt;)" replace="\1${nsys-voucher1}\3" />	
				
		<copy file="${db.dir}/global_install_query_upto_ec.sql" todir="${dist.dir}/${buildVers}/tmp"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/global_install_query_upto_ec.sql" flags="gis" byline="false" match="buildVersSql" replace="${buildVers}" />
	</target>
	
	<target name="delete_zip_upto_ec" if="zipToDeleteUpToEc"> 
		<delete file="${dist.dir}/${buildVers}/src/upto_eco${name}_${build.date}_${buildVers}.zip"/>
	</target> 
		
	<target name="task3" description="copy main source files into deploy dir, generate zip files">

		<condition property="dirToCreateApp"> 
			<and>
				<not>		
					<available file="${dist.dir}/${buildVers}" type="dir"> 
					</available>
				</not>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="dirToCreateApp: ${dirToCreateApp}" />		
		<antcall target="make_dir_app" />
		<echo message=""/>

		<condition property="zipToDeleteUpToEc"> 
			<and>		
				<available file="${dist.dir}/${buildVers}/src/upto_eco${name}_${build.date}_${buildVers}.zip"> 
				</available>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="zipToDeleteUpToEc: ${zipToDeleteUpToEc}" />		
		<antcall target="delete_zip_upto_ec" /> 
		<echo message=""/>
		
		<echo message=""/>
		<echo message="refresh template zip" />		
		<antcall target="refresh_template_zip" /> 
		<echo message=""/>
		
		<antcall target="taskReplaceUpEco" />

		<zip destfile="${dist.dir}/${buildVers}/src/upto_eco${name}_${build.date}_${buildVers}.zip"> 
			<zipfileset dir="${src.dir}">
				
				<!-- file inclusi -->								
				<include name="global.asax"/>
				<include name="web.config"/>
				<include name="area_user/vieworder.aspx"/>				
				<include name="area_user/userorders.aspx"/>				
				<include name="area_user/userorders.aspx.cs"/>		
				<include name="common/img/logo.png"/>					
				<include name="common/include/checkin.asp"/>
				<include name="common/include/checkin_fault.asp"/>
				<include name="common/include/download-order-attach.aspx"/>		
				<include name="backoffice/index.aspx"/>
				<include name="backoffice/countries/countrylist.aspx"/>
				<include name="backoffice/users/userlist.aspx"/>
				<include name="backoffice/users/insertuser.aspx"/>
				<include name="backoffice/users/insertfield.aspx"/>
				<include name="backoffice/templates/ajaxviewtemplate.aspx"/>
				<include name="backoffice/newsletter/newsletterlist.aspx"/>
				<include name="backoffice/newsletter/newsletterlist.aspx.cs"/>
				<include name="backoffice/newsletter/insertnewsletter.aspx"/>
				<include name="backoffice/newsletter/insertnewsletter.aspx.cs"/>
				<include name="backoffice/img/logo.png"/>				
				<include name="**/backoffice/shoppingcart/**"/>
				<include name="**/backoffice/orders/**"/>
				<include name="**/backoffice/payments/**"/>
				<include name="**/backoffice/products/**"/>
				<include name="**/backoffice/charges/**"/>
				<include name="**/backoffice/fees/**"/>
				<include name="**/backoffice/currency/**"/>
				<include name="**/backoffice/business-strategy/**"/>
				<include name="**/backoffice/supplements/**"/>
				<include name="public/layout/include/menu-frontend.ascx"/>		

				<include name="**/app_code/hbm/ads.hbm.xml"/>
				<include name="**/app_code/hbm/BillsAddress.hbm.xml"/>
				<include name="**/app_code/hbm/BusinessRule.hbm.xml"/>
				<include name="**/app_code/hbm/Currency.hbm.xml"/>
				<include name="**/app_code/hbm/Fee.hbm.xml"/>
				<include name="**/app_code/hbm/Order.hbm.xml"/>
				<include name="**/app_code/hbm/Payment.hbm.xml"/>
				<include name="**/app_code/hbm/Product.hbm.xml"/>
				<include name="**/app_code/hbm/ShippingAddress.hbm.xml"/>
				<include name="**/app_code/hbm/ShoppingCart.hbm.xml"/>
				<include name="**/app_code/hbm/Supplement.hbm.xml"/>
				<include name="**/app_code/hbm/Voucher.hbm.xml"/>			

				<include name="**/app_code/com/nemesys/model/ads/**/*"/>
				<include name="**/app_code/com/nemesys/model/business-strategy/**/*"/>
				<include name="**/app_code/com/nemesys/model/cart/**/*"/>
				<include name="**/app_code/com/nemesys/model/currency/**/*"/>
				<include name="**/app_code/com/nemesys/model/fees/**/*"/>
				<include name="**/app_code/com/nemesys/model/order/**/*"/>
				<include name="**/app_code/com/nemesys/model/payment/**/*"/>
				<include name="**/app_code/com/nemesys/model/product/**/*"/>
				<include name="**/app_code/com/nemesys/model/supplement/**/*"/>
				<include name="**/app_code/com/nemesys/model/voucher/**/*"/>

				<include name="**/app_code/com/nemesys/database/repository/AdsRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/BillsAddressRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/BusinessRuleRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/CurrencyRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/FeeRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/IAdsRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/IBillsAddressRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/IBusinessRuleRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/ICurrencyRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/IFeeRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/IOrderRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/IPaymentModuleRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/IPaymentRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/IPaymentTransactionRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/IProductRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/IShippingAddressRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/IShoppingCartRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/ISupplementGroupRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/ISupplementRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/IVoucherRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/OrderRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/PaymentModuleRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/PaymentRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/PaymentTransactionRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/ProductRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/ShippingAddressRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/ShoppingCartRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/SupplementGroupRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/SupplementRepository.cs"/>
				<include name="**/app_code/com/nemesys/database/repository/VoucherRepository.cs"/>		

				<include name="**/app_code/com/nemesys/services/BusinessRuleService.cs"/>
				<include name="**/app_code/com/nemesys/services/FeeService.cs"/>
				<include name="**/app_code/com/nemesys/services/OrderService.cs"/>
				<include name="**/app_code/com/nemesys/services/PaymentService.cs"/>
				<include name="**/app_code/com/nemesys/services/ProductService.cs"/>
				<include name="**/app_code/com/nemesys/services/ShoppingCartService.cs"/>
				<include name="**/app_code/com/nemesys/services/VoucherService.cs"/>			
			</zipfileset>
			
			<zipfileset dir="${mod_install.dir}" includes="portalinstall.aspx" prefix="public/install"/>			
			<zipfileset dir="${mod_install.dir}/replace-resource" includes="nemesys_replace.properties" prefix="public/install"/>
			<zipfileset dir="${mod_install.dir}/replace-resource" includes="econemesys_replace.properties" prefix="public/install"/>

			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/include" includes="menu.ascx" prefix="backoffice/include"/>
			
			<!-- includo il logo di neme-sys al posto del logo econeme-sys -->
			<zipfileset dir="${snippet.dir}/ecommerce/common/img" includes="logo.png" prefix="common/img"/>
			<zipfileset dir="${snippet.dir}/ecommerce" includes="favicon.ico" prefix=""/>

			<!-- includo il file global_install_query.sql di creazione/inserimento database -->
			<zipfileset dir="${dist.dir}/${buildVers}/tmp" includes="global_install_query_upto_ec.sql" fullpath="public/install/global_install_query.sql"/>

			<!-- includo i template di esempio di econeme-sys dentro la directory public/utils -->
			<zipfileset dir="${src.dir}/public/utils" includes="templates_econeme-sys.zip" fullpath="public/utils/templates_neme-sys.zip"/>
			
			<!-- reintegro il template base, contact e search dentro la directory public/templates -->
			<zipfileset dir="${src.dir}/public/templates" includes="base/**/*" prefix="public/templates"/>
			<zipfileset dir="${src.dir}/public/templates" includes="base-product/**/*" prefix="public/templates"/>
			<zipfileset dir="${src.dir}/public/templates" includes="search/**/*" prefix="public/templates"/>
			<zipfileset dir="${src.dir}/public/templates" includes="contact/**/*" prefix="public/templates"/>	
			<zipfileset dir="${src.dir}/public/templates" includes="shopping-card/**/*" prefix="public/templates"/>
			
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter" includes="newsletterlist.aspx" prefix="backoffice/newsletter"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter" includes="newsletterlist.aspx.cs" prefix="backoffice/newsletter"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter" includes="insertnewsletter.aspx" prefix="backoffice/newsletter"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/newsletter" includes="insertnewsletter.aspx.cs" prefix="backoffice/newsletter"/>
			
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/business-strategy" includes="insertbusinessrule.aspx" prefix="backoffice/business-strategy"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/backoffice/business-strategy" includes="insertbusinessrule.aspx.cs" prefix="backoffice/business-strategy"/>
					
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/app_data/conf" includes="nemesys-config.xml" fullpath="app_data/conf/nemesys-config.xml"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/area_user" includes="account.ascx" prefix="public/layout/area_user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/css" includes="stile.css" prefix="public/layout/css"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/include" includes="header.ascx" prefix="public/layout/include"/>	
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user" includes="user-profile-widget.ascx" prefix="public/layout/addson/user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user" includes="user-mask-widget.ascx" prefix="public/layout/addson/user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user" includes="user-online-widget.ascx" prefix="public/layout/addson/user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/addson/comments" includes="comments-widget.ascx" prefix="public/layout/addson/comments"/>			
		</zip>

		<delete includeemptydirs="true">
			<fileset dir="${dist.dir}/${buildVers}/tmp" includes="**/*"/>
		</delete>

	</target>	
	


<!--  *****************		BUILD ALL		***************** -->	
	<target name="task4" depends="task1,task2,task3" description="build all"/>
	


<!--  *****************		BUILD DEMO	***************** -->		
	<target name="taskReplaceDemo">
		<loadproperties srcFile="${mod_install.dir}/replace-resource/demo_replace.properties"/>
		
		<copy file="${src.dir}/installed.asp" todir="${dist.dir}/demo/${buildVers}/src"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/installed.asp" flags="gis" byline="false" match="(&lt;!--nsys-demoinst1--&gt;)(.*?)(&lt;!---nsys-demoinst1--&gt;)" replace="\1${nsys-demoinst1}\3" />	
		
		<copy file="${src.dir}/public/conf/nemesi_config.xml" todir="${dist.dir}/demo/${buildVers}/src/public/conf"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig1--&gt;)(.*?)(&lt;!---nsys-nemesiconfig1--&gt;)" replace="\1${nsys-nemesiconfig1}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig2--&gt;)(.*?)(&lt;!---nsys-nemesiconfig2--&gt;)" replace="\1${nsys-nemesiconfig2}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig3--&gt;)(.*?)(&lt;!---nsys-nemesiconfig3--&gt;)" replace="\1${nsys-nemesiconfig3}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig4--&gt;)(.*?)(&lt;!---nsys-nemesiconfig4--&gt;)" replace="\1${nsys-nemesiconfig4}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig5--&gt;)(.*?)(&lt;!---nsys-nemesiconfig5--&gt;)" replace="\1${nsys-nemesiconfig5}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig6--&gt;)(.*?)(&lt;!---nsys-nemesiconfig6--&gt;)" replace="\1${nsys-nemesiconfig6}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig7--&gt;)(.*?)(&lt;!---nsys-nemesiconfig7--&gt;)" replace="\1${nsys-nemesiconfig7}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig8--&gt;)(.*?)(&lt;!---nsys-nemesiconfig8--&gt;)" replace="\1${nsys-nemesiconfig8}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig9--&gt;)(.*?)(&lt;!---nsys-nemesiconfig9--&gt;)" replace="\1${nsys-nemesiconfig9}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig10--&gt;)(.*?)(&lt;!---nsys-nemesiconfig10--&gt;)" replace="\1${nsys-nemesiconfig10}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig11--&gt;)(.*?)(&lt;!---nsys-nemesiconfig11--&gt;)" replace="\1${nsys-nemesiconfig11}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig12--&gt;)(.*?)(&lt;!---nsys-nemesiconfig12--&gt;)" replace="\1${nsys-nemesiconfig12}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig13--&gt;)(.*?)(&lt;!---nsys-nemesiconfig13--&gt;)" replace="\1${nsys-nemesiconfig13}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig14--&gt;)(.*?)(&lt;!---nsys-nemesiconfig14--&gt;)" replace="\1${nsys-nemesiconfig14}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig15--&gt;)(.*?)(&lt;!---nsys-nemesiconfig15--&gt;)" replace="\1${nsys-nemesiconfig15}\3" />

		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;/)(.*?)(&gt;)" replace="\1demo_\2\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(attr_)(.*?)(&gt;)" replace="\1demo_\2\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;)(([^/|!]).*?)(&gt;)" replace="\1demo_\2\4" />
		
		<copy file="${src.dir}/public/layout/css/stile.css" todir="${dist.dir}/demo/${buildVers}/src/public/layout/css"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/layout/css/stile.css" flags="gis" byline="false" match="(/\*&lt;!--nsys-css1--&gt;\*/)(.*?)(/\*&lt;!---nsys-css1--&gt;\*/)" replace="\1${nsys-css1}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/layout/css/stile.css" flags="gis" byline="false" match="(/\*&lt;!--nsys-democss1--&gt;\*/)(.*?)(/\*&lt;!---nsys-democss1--&gt;\*/)" replace="\1${nsys-democss1}\3" />
		
		<copy file="${src.dir}/public/layout/include/header.inc" todir="${dist.dir}/demo/${buildVers}/src/public/layout/include"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/layout/include/header.inc" flags="gis" byline="false" match="(&lt;!--nsys-head1--&gt;)(.*?)(&lt;!---nsys-head1--&gt;)" replace="\1${nsys-head1}\3" />
		
		<copy file="${src.dir}/common/include/logoff.asp" todir="${dist.dir}/demo/${buildVers}/src/common/include"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/common/include/logoff.asp" flags="gis" byline="false" match="('&lt;!--nsys-demologoff1--&gt;)(.*?)('&lt;!---nsys-demologoff1--&gt;)" replace="\1${nsys-demologoff1}\3" />
		
		<copy file="${src.dir}/common/include/verificautente.asp" todir="${dist.dir}/demo/${buildVers}/src/common/include"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/common/include/verificautente.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoverify1--&gt;)(.*?)('&lt;!---nsys-demoverify1--&gt;)" replace="\1${nsys-demoverify1}\3" />
		
		<copy file="${src.dir}/backoffice/configuration/portalconfig.asp" todir="${dist.dir}/demo/${buildVers}/src/backoffice/configuration"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/configuration/portalconfig.asp" flags="gis" byline="false" match="(&lt;!--nsys-democonf1--&gt;)(.*?)(&lt;!---nsys-democonf1--&gt;)" replace="\1${nsys-democonf1}\3" />
		
		<copy file="${src.dir}/backoffice/contenuti/processnews2.asp" todir="${dist.dir}/demo/${buildVers}/src/backoffice/contenuti"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/contenuti/processnews2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demonwsproc1--&gt;)(.*?)('&lt;!---nsys-demonwsproc1--&gt;)" replace="\1${nsys-demonwsproc1}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/contenuti/processnews2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demonwsproc2--&gt;)(.*?)('&lt;!---nsys-demonwsproc2--&gt;)" replace="\1${nsys-demonwsproc2}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/contenuti/processnews2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demonwsproc3--&gt;)(.*?)('&lt;!---nsys-demonwsproc3--&gt;)" replace="\1${nsys-demonwsproc3}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/contenuti/processnews2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demonwsproc4--&gt;)(.*?)('&lt;!---nsys-demonwsproc4--&gt;)" replace="\1${nsys-demonwsproc4}\3" />
		
		<copy file="${src.dir}/backoffice/contenuti/processnews.asp" todir="${dist.dir}/demo/${buildVers}/src/backoffice/contenuti"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/contenuti/processnews.asp" flags="gis" byline="false" match="('&lt;!--nsys-demonwsproc5--&gt;)(.*?)('&lt;!---nsys-demonwsproc5--&gt;)" replace="\1${nsys-demonwsproc5}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/contenuti/processnews.asp" flags="gis" byline="false" match="('&lt;!--nsys-demonwsproc6--&gt;)(.*?)('&lt;!---nsys-demonwsproc6--&gt;)" replace="\1${nsys-demonwsproc6}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/contenuti/processnews.asp" flags="gis" byline="false" match="('&lt;!--nsys-demonwsproc7--&gt;)(.*?)('&lt;!---nsys-demonwsproc7--&gt;)" replace="\1${nsys-demonwsproc7}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/contenuti/processnews.asp" flags="gis" byline="false" match="('&lt;!--nsys-demonwsproc8--&gt;)(.*?)('&lt;!---nsys-demonwsproc8--&gt;)" replace="\1${nsys-demonwsproc8}\3" />
		
		<copy file="${src.dir}/backoffice/prodotti/processprodotto.asp" todir="${dist.dir}/demo/${buildVers}/src/backoffice/prodotti"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/prodotti/processprodotto.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc1--&gt;)(.*?)('&lt;!---nsys-demoprdproc1--&gt;)" replace="\1${nsys-demoprdproc1}\3" />	
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/prodotti/processprodotto.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc2--&gt;)(.*?)('&lt;!---nsys-demoprdproc2--&gt;)" replace="\1${nsys-demoprdproc2}\3" />	
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/prodotti/processprodotto.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc3--&gt;)(.*?)('&lt;!---nsys-demoprdproc3--&gt;)" replace="\1${nsys-demoprdproc3}\3" />	
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/prodotti/processprodotto.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc4--&gt;)(.*?)('&lt;!---nsys-demoprdproc4--&gt;)" replace="\1${nsys-demoprdproc4}\3" />	
		
		<copy file="${src.dir}/backoffice/prodotti/processprodotto2.asp" todir="${dist.dir}/demo/${buildVers}/src/backoffice/prodotti"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/prodotti/processprodotto2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc5--&gt;)(.*?)('&lt;!---nsys-demoprdproc5--&gt;)" replace="\1${nsys-demoprdproc5}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/prodotti/processprodotto2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc6--&gt;)(.*?)('&lt;!---nsys-demoprdproc6--&gt;)" replace="\1${nsys-demoprdproc6}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/prodotti/processprodotto2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc7--&gt;)(.*?)('&lt;!---nsys-demoprdproc7--&gt;)" replace="\1${nsys-demoprdproc7}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/prodotti/processprodotto2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc8--&gt;)(.*?)('&lt;!---nsys-demoprdproc8--&gt;)" replace="\1${nsys-demoprdproc8}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/prodotti/processprodotto2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc9--&gt;)(.*?)('&lt;!---nsys-demoprdproc9--&gt;)" replace="\1${nsys-demoprdproc9}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/prodotti/processprodotto2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc10--&gt;)(.*?)('&lt;!---nsys-demoprdproc10--&gt;)" replace="\1${nsys-demoprdproc10}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/prodotti/processprodotto2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc11--&gt;)(.*?)('&lt;!---nsys-demoprdproc11--&gt;)" replace="\1${nsys-demoprdproc11}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/prodotti/processprodotto2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc12--&gt;)(.*?)('&lt;!---nsys-demoprdproc12--&gt;)" replace="\1${nsys-demoprdproc12}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/prodotti/processprodotto2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc13--&gt;)(.*?)('&lt;!---nsys-demoprdproc13--&gt;)" replace="\1${nsys-demoprdproc13}\3" />
		
		<copy file="${src.dir}/backoffice/users/listautenti.asp" todir="${dist.dir}/demo/${buildVers}/src/backoffice/users"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/users/listautenti.asp" flags="gis" byline="false" match="(&lt;!--nsys-demoeditusr1--&gt;)(.*?)(&lt;!---nsys-demoeditusr1--&gt;)" replace="\1${nsys-demoeditusr1}\3" />
				
		<copy file="${src.dir}/backoffice/templates/listatemplates.asp" todir="${dist.dir}/demo/${buildVers}/src/backoffice/templates"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/templates/listatemplates.asp" flags="gis" byline="false" match="(/\*&lt;!--nsys-demoedittmp1--&gt;\*/)(.*?)(/\*&lt;!---nsys-demoedittmp1--&gt;\*/)" replace="\1${nsys-demoedittmp1}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/templates/listatemplates.asp" flags="gis" byline="false" match="(/\*&lt;!--nsys-demoedittmp2--&gt;\*/)(.*?)(/\*&lt;!---nsys-demoedittmp2--&gt;\*/)" replace="\1${nsys-demoedittmp2}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/templates/listatemplates.asp" flags="gis" byline="false" match="(/\*&lt;!--nsys-demoedittmp3--&gt;\*/)(.*?)(/\*&lt;!---nsys-demoedittmp3--&gt;\*/)" replace="\1${nsys-demoedittmp3}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/templates/listatemplates.asp" flags="gis" byline="false" match="(/\*&lt;!--nsys-demoedittmp4--&gt;\*/)(.*?)(/\*&lt;!---nsys-demoedittmp4--&gt;\*/)" replace="\1${nsys-demoedittmp4}\3" />
				
		<copy file="${src.dir}/backoffice/language/inseriscilingua.asp" todir="${dist.dir}/demo/${buildVers}/src/backoffice/language"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/language/inseriscilingua.asp" flags="gis" byline="false" match="(/\*&lt;!--nsys-demolangtmp1--&gt;\*/)(.*?)(/\*&lt;!---nsys-demolangtmp1--&gt;\*/)" replace="\1${nsys-demolangtmp1}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/backoffice/language/inseriscilingua.asp" flags="gis" byline="false" match="(/\*&lt;!--nsys-demolangtmp2--&gt;\*/)(.*?)(/\*&lt;!---nsys-demolangtmp2--&gt;\*/)" replace="\1${nsys-demolangtmp2}\3" />
		
		<!-- includo il file global_install_query.sql di creazione/inserimento database -->
		<copy file="${db.dir}/global_install_query_demo.sql" todir="${dist.dir}/demo/${buildVers}/src/public/install"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/install/global_install_query_demo.sql" flags="gis" byline="false" match="buildVersSql" replace="${buildVers}" />
		<!-- includo il file global_reload_query.sql di aggiornamento database -->
		<copy file="${db.dir}/global_reload_query_demo.sql" todir="${dist.dir}/demo/${buildVers}/src/public/install"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/install/global_reload_query_demo.sql" flags="gis" byline="false" match="buildVersSql" replace="${buildVers}" />
	</target>
	
	<target name="delete_zip_demo" if="zipToDeleteDemo"> 
		<delete file="${dist.dir}/demo/${buildVers}/eco${name}.demo_${build.date}_${buildVers}.zip"/>
	</target>
	
	<target name="task5" description="copy main source files into demo dir, generate zip files">

		<condition property="dirToCreateDemo"> 
			<and>
				<not>		
					<available file="${dist.dir}/demo/${buildVers}" type="dir"> 
					</available>
				</not>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="dirToCreateDemo: ${dirToCreateDemo}" />		
		<antcall target="make_dir_demo" /> 
		<echo message=""/>

		<condition property="zipToDeleteDemo"> 
			<and>		
				<available file="${dist.dir}/demo/${buildVers}/eco${name}.demo_${build.date}_${buildVers}.zip"> 
				</available>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="zipToDeleteDemo: ${zipToDeleteDemo}" />		
		<antcall target="delete_zip_demo" /> 
		<echo message=""/>
		
		<echo message=""/>
		<echo message="refresh template zip" />		
		<antcall target="refresh_template_zip" /> 
		<echo message=""/>

		<antcall target="taskReplaceDemo" />
		
		<copy todir="${dist.dir}/demo/${buildVers}/src">
			<fileset dir="${src.dir}"> 
				<include name="**/*"/>
				
				<exclude name="sitemap.xml"/>
				<exclude name="installed.asp"/>
				<exclude name="global.asa"/>
				<exclude name="global.asa.remote"/>
				<exclude name="global.asax.old"/>
				<exclude name="web.config"/>
				<exclude name="smsutils.asp"/>
				<exclude name="**/public/demo/**"/>
				<exclude name="**/test/**"/>
				<exclude name="**/app_data/**/*"/>
				<exclude name="favicon.ico"/>

				<exclude name="/common/include/logoff.asp"/>				
				<exclude name="/common/include/verificautente.asp"/>
				
				<exclude name="**/public/layout/css/stile.css"/>
				<exclude name="**/public/layout/include/header.inc"/>
				
				<exclude name="**/public/templates/**/IT/**"/>
				<exclude name="**/public/templates/**/EN/**"/>		
				
				<exclude name="**/backoffice/configuration/portalconfig.asp"/>
				<exclude name="**/backoffice/contenuti/processnews.asp"/>
				<exclude name="**/backoffice/contenuti/processnews2.asp"/>
				<exclude name="**/backoffice/prodotti/processprodotto.asp"/>
				<exclude name="**/backoffice/prodotti/processprodotto2.asp"/>
				<exclude name="**/backoffice/users/listautenti.asp"/>
				<exclude name="**/backoffice/templates/listatemplates.asp"/>
				
				<exclude name="**/public/upload/wysiwyg_editor/*.*"/>
				<exclude name="**/public/upload/files/news/**/*"/>
				<exclude name="**/public/upload/files/prod/**/*"/>
				<include name="**/public/upload/files/prod/fields/*"/>
				<exclude name="**/public/upload/files/user/**/*"/>
				<exclude name="**/public/upload/files/header/**/*"/>
				<exclude name="**/public/upload/files/modules/**/*"/>
				
				<exclude name="**/public/utils/${docname}"/>
				
				<exclude name="**/public/conf/nemesi_config.xml"/>		

				<exclude name="**/public/utils/templates_neme-sys.zip"/>
			</fileset>
		</copy>

		<!-- sostituisco  tutte le occorrenze di 
				#include virtual="** 
				con 
				#include virtual="/public/demo 
				e di
				Application("
				con
				Application("demo_
				-->
		<replace dir="${dist.dir}/demo/${buildVers}/src" 
						token="#include virtual=&quot;" 
						value="#include virtual=&quot;/public/demo">
						<include name="**/*"/>
						<exclude name="**/*.sql"/>	
		</replace>
		<replace dir="${dist.dir}/demo/${buildVers}/src" 
						token="Application(&quot;" 
						value="Application(&quot;demo_">
						<include name="**/*"/>
						<exclude name="**/*.sql"/>
		</replace>


		<!--<xslt basedir="${dist.dir}/demo/${buildVers}/src" destdir="${dist.dir}/demo/${buildVers}/src" style="${dens}">
			<include name="**/*"/>
		</xslt> -->

		<zip destfile="${dist.dir}/demo/${buildVers}/eco${name}.demo_${build.date}_${buildVers}.zip"> 
			<zipfileset dir="${dist.dir}/demo/${buildVers}/src"> 
				<include name="**/*"/>
				<exclude name="**/public/utils/templates_econeme-sys.zip"/>				
			</zipfileset>
			
			<zipfileset dir="${mod_install.dir}" includes="demoinstall.asp" fullpath="public/install/demoinstall.asp"/>
			<zipfileset dir="${mod_install.dir}" includes="demoreload.asp" fullpath="public/install/demoreload.asp"/>
			
			<zipfileset dir="${docs.dir}" includes="eco${docname}" fullpath="public/utils/eco${docname}"/>

			<!-- includo i template di esempio di econeme-sys dentro la directory public/utils -->
			<zipfileset dir="${dist.dir}/demo/${buildVers}/src/public/utils" includes="templates_econeme-sys.zip" fullpath="public/utils/templates_neme-sys.zip"/>
		</zip>

		<!-- aggiorno nuovamente la directory ${src.dir}/public/demo con tutti i nuovi file modificati -->		
		<!--<unzip src="${dist.dir}/demo/${buildVers}/eco${name}.demo_${build.date}_${buildVers}.zip" dest="${src.dir}/public/demo" overwrite="true"/>-->
			
		<delete includeemptydirs="true">
			<fileset dir="${dist.dir}/demo/${buildVers}/src" includes="**/*"/>
		</delete>

	</target>
	
	
	<!--  *****************		BUILD MODULE COMMUNITY		***************** -->
	<target name="taskReplaceModCommunity">		
		<copy file="${mod_install.dir}/sql-resource/mod-community_install_query.sql" todir="${dist.dir}/${buildVers}/tmp"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/mod-community_install_query.sql" flags="gis" byline="false" match="buildVersSql" replace="${buildVers}" />
	</target>
	
	<target name="delete_zip_mod_community" if="zipToDeleteModCommunity"> 
		<delete file="${dist.dir}/${buildVers}/src/mod-community_${build.date}_${buildVers}.zip"/>
	</target> 
		
	<target name="task6" description="copy main source files into deploy dir, generate zip files">

		<condition property="dirToCreateApp"> 
			<and>
				<not>		
					<available file="${dist.dir}/${buildVers}" type="dir"> 
					</available>
				</not>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="dirToCreateApp: ${dirToCreateApp}" />		
		<antcall target="make_dir_app" />
		<echo message=""/>

		<condition property="zipToDeleteModCommunity"> 
			<and>		
				<available file="${dist.dir}/${buildVers}/src/mod-community_${build.date}_${buildVers}.zip"> 
				</available>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="zipToDeleteModCommunity: ${zipToDeleteModCommunity}" />		
		<antcall target="delete_zip_mod_community" /> 
		<echo message=""/>

		<antcall target="taskReplaceModCommunity" />
		
		<zip destfile="${dist.dir}/${buildVers}/src/mod-community_${build.date}_${buildVers}.zip"> 
			<zipfileset dir="${src.dir}">
				
				<!-- file inclusi -->								
				<include name="area_user/friends.aspx"/>				
				<include name="area_user/photos.aspx"/>	
				<include name="area_user/publicprofile.aspx"/>
				<include name="public/layout/area_user/friends.ascx"/>
				<include name="public/layout/area_user/photos.ascx"/>
				<include name="public/layout/area_user/publicprofile.ascx"/>				
			</zipfileset>
			
			<zipfileset dir="${mod_install.dir}" includes="mod-communityinstall.aspx" fullpath="public/install/moduleinstall.aspx"/>
			<zipfileset dir="${mod_install.dir}/replace-resource" includes="mod-community_replace.properties" prefix="public/install"/>			
			<zipfileset dir="${mod_install.dir}/file-resource" includes="installed.aspx"/>
			<zipfileset dir="${mod_install.dir}/file-resource" includes="ReadMe.txt"/>
			
			<!-- includo il file global_install_query.sql di creazione/inserimento database -->
			<zipfileset dir="${dist.dir}/${buildVers}/tmp" includes="mod-community_install_query.sql" fullpath="public/install/module_install_query.sql"/>
		</zip>

		<delete includeemptydirs="true">
			<fileset dir="${dist.dir}/${buildVers}/tmp" includes="**/*"/>
		</delete>
	</target>	
	
	
	<!--  *****************		BUILD MODULE BLOG		***************** -->
	<target name="taskReplaceModBlog">
		<loadproperties srcFile="${mod_install.dir}/replace-resource/mod-blog_replace.properties"/>
		
		<copy file="${src.dir}/area_user/ads/contentlist.aspx" todir="${dist.dir}/${buildVers}/tmp/area_user/ads"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/ads/contentlist.aspx" flags="gis" byline="false" match="(/\*&lt;!--nsys-usr-lnews1--&gt;\*/)(.*?)(/\*&lt;!---nsys-usr-lnews1--&gt;\*/)" replace="\1${nsys-usr-lnews1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/ads/contentlist.aspx" flags="gis" byline="false" match="(&lt;!--nsys-usr-lnews3--&gt;)(.*?)(&lt;!---nsys-usr-lnews3--&gt;)" replace="\1${nsys-usr-lnews3}\3" />
		
		<copy file="${mod_install.dir}/sql-resource/mod-blog_install_query.sql" todir="${dist.dir}/${buildVers}/tmp"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/mod-blog_install_query.sql" flags="gis" byline="false" match="buildVersSql" replace="${buildVers}" />
	</target>
	
	<target name="delete_zip_mod_blog" if="zipToDeleteModBlog"> 
		<delete file="${dist.dir}/${buildVers}/src/mod-blog_${build.date}_${buildVers}.zip"/>
	</target> 
		
	<target name="task7" description="copy main source files into deploy dir, generate zip files">

		<condition property="dirToCreateApp"> 
			<and>
				<not>		
					<available file="${dist.dir}/${buildVers}" type="dir"> 
					</available>
				</not>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="dirToCreateApp: ${dirToCreateApp}" />		
		<antcall target="make_dir_app" />
		<echo message=""/>

		<condition property="zipToDeleteModBlog"> 
			<and>		
				<available file="${dist.dir}/${buildVers}/src/mod-blog_${build.date}_${buildVers}.zip"> 
				</available>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="zipToDeleteModBlog: ${zipToDeleteModBlog}" />		
		<antcall target="delete_zip_mod_blog" /> 
		<echo message=""/>

		<antcall target="taskReplaceModBlog" />
		
		<zip destfile="${dist.dir}/${buildVers}/src/mod-blog_${build.date}_${buildVers}.zip"> 
			<zipfileset dir="${src.dir}">
				
				<!-- file inclusi -->
				<include name="**/area_user/ads/**/*"/>	
				<exclude name="**/area_user/ads/contentlist.aspx"/>	
				<exclude name="**/area_user/ads/insertads.aspx"/>		
				<exclude name="**/area_user/ads/insertads.aspx.cs"/>		
			</zipfileset>
			
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/area_user/ads" includes="contentlist.aspx" prefix="area_user/ads"/>	
			
			<zipfileset dir="${mod_install.dir}" includes="mod-bloginstall.aspx" fullpath="public/install/moduleinstall.aspx"/>
			<zipfileset dir="${mod_install.dir}/replace-resource" includes="mod-blog_replace.properties" prefix="public/install"/>			
			<zipfileset dir="${mod_install.dir}/file-resource" includes="installed.aspx"/>
			<zipfileset dir="${mod_install.dir}/file-resource" includes="ReadMe.txt"/>
			
			<!-- includo il file global_install_query.sql di creazione/inserimento database -->
			<zipfileset dir="${dist.dir}/${buildVers}/tmp" includes="mod-blog_install_query.sql" fullpath="public/install/module_install_query.sql"/>
		</zip>

		<delete includeemptydirs="true">
			<fileset dir="${dist.dir}/${buildVers}/tmp" includes="**/*"/>
		</delete>
	</target>	
	
	
	<!--  *****************		BUILD MODULE ADS		***************** -->
	<target name="taskReplaceModAds">
		<loadproperties srcFile="${mod_install.dir}/replace-resource/mod-ads_replace.properties"/>
	
		<copy file="${mod_install.dir}/sql-resource/mod-ads_install_query.sql" todir="${dist.dir}/${buildVers}/tmp"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/mod-ads_install_query.sql" flags="gis" byline="false" match="buildVersSql" replace="${buildVers}" />
	</target>
	
	<target name="delete_zip_mod_ads" if="zipToDeleteModAds"> 
		<delete file="${dist.dir}/${buildVers}/src/mod-ads_${build.date}_${buildVers}.zip"/>
	</target> 
		
	<target name="task8" description="copy main source files into deploy dir, generate zip files">

		<condition property="dirToCreateApp"> 
			<and>
				<not>		
					<available file="${dist.dir}/${buildVers}" type="dir"> 
					</available>
				</not>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="dirToCreateApp: ${dirToCreateApp}" />		
		<antcall target="make_dir_app" />
		<echo message=""/>

		<condition property="zipToDeleteModAds"> 
			<and>		
				<available file="${dist.dir}/${buildVers}/src/mod-ads_${build.date}_${buildVers}.zip"> 
				</available>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="zipToDeleteModAds: ${zipToDeleteModAds}" />		
		<antcall target="delete_zip_mod_ads" /> 
		<echo message=""/>

		<antcall target="taskReplaceModAds" />
		
		<zip destfile="${dist.dir}/${buildVers}/src/mod-ads_${build.date}_${buildVers}.zip"> 
			<zipfileset dir="${src.dir}">
				<!-- file inclusi -->
				<include name="**/area_user/ads/**/*"/>	
			</zipfileset>
			
			<zipfileset dir="${mod_install.dir}" includes="mod-adsinstall.aspx" fullpath="public/install/moduleinstall.aspx"/>
			<zipfileset dir="${mod_install.dir}/replace-resource" includes="mod-ads_replace.properties" prefix="public/install"/>			
			<zipfileset dir="${mod_install.dir}/file-resource" includes="installed.aspx"/>
			<zipfileset dir="${mod_install.dir}/file-resource" includes="ReadMe.txt"/>
			
			<!-- includo il file global_install_query.sql di creazione/inserimento database -->
			<zipfileset dir="${dist.dir}/${buildVers}/tmp" includes="mod-ads_install_query.sql" fullpath="public/install/module_install_query.sql"/>
		</zip>

		<delete includeemptydirs="true">
			<fileset dir="${dist.dir}/${buildVers}/tmp" includes="**/*"/>
		</delete>
	</target>
	
	
	<!--  *****************		BUILD MODULE VOUCHER		***************** -->
	<target name="taskReplaceModVoucher">
		<loadproperties srcFile="${mod_install.dir}/replace-resource/mod-voucher_replace.properties"/>
	
		<copy file="${mod_install.dir}/sql-resource/mod-voucher_install_query.sql" todir="${dist.dir}/${buildVers}/tmp"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/mod-voucher_install_query.sql" flags="gis" byline="false" match="buildVersSql" replace="${buildVers}" />
	</target>
	
	<target name="delete_zip_mod_voucher" if="zipToDeleteModVoucher"> 
		<delete file="${dist.dir}/${buildVers}/src/mod-voucher_${build.date}_${buildVers}.zip"/>
	</target> 
		
	<target name="task9" description="copy main source files into deploy dir, generate zip files">

		<condition property="dirToCreateApp"> 
			<and>
				<not>		
					<available file="${dist.dir}/${buildVers}" type="dir"> 
					</available>
				</not>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="dirToCreateApp: ${dirToCreateApp}" />		
		<antcall target="make_dir_app" />
		<echo message=""/>

		<condition property="zipToDeleteModVoucher"> 
			<and>		
				<available file="${dist.dir}/${buildVers}/src/mod-voucher_${build.date}_${buildVers}.zip"> 
				</available>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="zipToDeleteModVoucher: ${zipToDeleteModVoucher}" />		
		<antcall target="delete_zip_mod_voucher" /> 
		<echo message=""/>

		<antcall target="taskReplaceModVoucher" />
		
		<zip destfile="${dist.dir}/${buildVers}/src/mod-voucher_${build.date}_${buildVers}.zip"> 
			<zipfileset dir="${src.dir}">
				<!-- file inclusi -->
				<include name="backoffice/include/menu.ascx"/>
				<include name="**/backoffice/voucher/**"/>		
				<include name="backoffice/newsletter/newsletterlist.aspx"/>
				<include name="backoffice/newsletter/newsletterlist.aspx.cs"/>
				<include name="backoffice/newsletter/insertnewsletter.aspx"/>
				<include name="backoffice/newsletter/insertnewsletter.aspx.cs"/>
				<include name="backoffice/business-strategy/insertbusinessrule.aspx"/>
				<include name="backoffice/business-strategy/insertbusinessrule.aspx.cs"/>
			</zipfileset>
			
			<zipfileset dir="${mod_install.dir}" includes="mod-voucherinstall.aspx" fullpath="public/install/moduleinstall.aspx"/>
			<zipfileset dir="${mod_install.dir}/replace-resource" includes="mod-voucher_replace.properties" prefix="public/install"/>			
			<zipfileset dir="${mod_install.dir}/file-resource" includes="installed.aspx"/>
			<zipfileset dir="${mod_install.dir}/file-resource" includes="ReadMe.txt"/>
			
			<!-- includo il file global_install_query.sql di creazione/inserimento database -->
			<zipfileset dir="${dist.dir}/${buildVers}/tmp" includes="mod-voucher_install_query.sql" fullpath="public/install/module_install_query.sql"/>
		</zip>

		<delete includeemptydirs="true">
			<fileset dir="${dist.dir}/${buildVers}/tmp" includes="**/*"/>
		</delete>
	</target>
	
	


	<!--  *****************		TASK DI PROVA PER SPERIMENTARE FUNZIONALITA' ANT	***************** -->
	<target name="tasktestreplace">
		<loadproperties srcFile="${mod_install.dir}/test.properties"/>

		<copy file="${src.dir}/area_user/ads/listanews.asp" todir="${dist.dir}/${buildVers}/tmp/area_user/ads"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/ads/listanews.asp" flags="gis" byline="false" match="(/\*nsys-usr-lnews1\*/)(.*?)(/\*-nsys-usr-lnews1\*/)" replace="\1${nsys-usr-lnews1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/ads/listanews.asp" flags="gis" byline="false" match="(&lt;!--nsys-usr-lnews2--&gt;)(.*?)(&lt;!---nsys-usr-lnews2--&gt;)" replace="\1${nsys-usr-lnews2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/ads/listanews.asp" flags="gis" byline="false" match="(&lt;!--nsys-usr-lnews3--&gt;)(.*?)(&lt;!---nsys-usr-lnews3--&gt;)" replace="\1${nsys-usr-lnews3}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/ads/listanews.asp" flags="gis" byline="false" match="(&lt;!--nsys-usr-lnews4--&gt;)(.*?)(&lt;!---nsys-usr-lnews4--&gt;)" replace="\1${nsys-usr-lnews4}\3" />		
		
		<!--<replaceregexp flags="gis" byline="false" match="(&lt;div id=&quot;top-bar-lenguage&quot;&gt;)(.*?)(&lt;/div&gt;)">
		<substitution expression="\1${key.n}\3"/>
		<fileset dir="${mod_install.dir}">
			<include name="moduleinstall.asp"/>
		</fileset>
		</replaceregexp>-->

		<!--<replace dir="${dist.dir}/demo/${buildVers}/src"> 
			<include name="**/*"/>		    
			<replacefilter>
				<replacetoken><![CDATA[<cfinclude template="/MachII/customtags/view/helper/viewTagBuilder.cfm" />]]></replacetoken>  
				<replacevalue><![CDATA[two line token]]></replacevalue>
			</replacefilter>
		</replace>
		
		<replace file="${temp.dir.web-inf}/applicationContext.xml" token="@db_url@" value="${db_url}" />
		-->
	</target>
</project>